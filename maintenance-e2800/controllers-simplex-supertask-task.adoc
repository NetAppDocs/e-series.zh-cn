---
permalink: maintenance-e2800/controllers-simplex-supertask-task.html 
sidebar: sidebar 
keywords: replace E2800 controller, replacing E2800 controller, simplex controller replacement, E2800, E-Series, eseries 
summary: 您可以在单工配置中更换发生故障的控制器箱。 
---
= 更换 E2800 单工配置中的控制器
:allow-uri-read: 
:experimental: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在单工（单控制器）配置中，您可以更换以下控制器架中发生故障的控制器箱：

* E2812 控制器架
* E2824 控制器架


.关于此任务
控制器箱包含一个控制器卡，一个电池和一个可选的主机接口卡（ HIC ）。更换发生故障的控制器箱时，您必须从原始控制器箱中取出电池和 HIC （如果已安装），然后将其安装到替代控制器箱中。

.开始之前
确保您已具备以下条件：

* 与要更换的控制器箱部件号相同的替代控制器箱。
* ESD 腕带，或者您已采取其他防静电预防措施。
* 用于标识连接到控制器箱的每个缆线的标签。
* 1 号十字螺丝刀。
* 一个管理工作站，其浏览器可访问控制器的 SANtricity 系统管理器。（要打开 System Manager 界面，请将浏览器指向控制器的域名或 IP 地址。）




== 第 1 步：准备更换控制器（单工）

准备通过保存驱动器安全密钥，备份配置和收集支持数据来更换控制器箱。然后，您可以停止主机 I/O 操作并关闭控制器架。

.步骤
. 如果可能，请记下控制器上当前安装的 SANtricity OS 软件版本。打开 SANtricity 系统管理器，然后选择菜单： Support[ 升级中心 > 查看软件和固件清单 ] 。
. 如果启用了驱动器安全功能，请确保存在已保存的密钥，并且您知道安装该密钥所需的密码短语。
+

CAUTION: * 可能丢失数据访问 * - 如果存储阵列中的所有驱动器均已启用安全性，则新控制器将无法访问存储阵列，除非您使用 SANtricity 存储管理器中的企业管理窗口解锁受保护的驱动器。

+
要保存密钥（可能无法保存，具体取决于控制器的状态）：

+
.. 在 SANtricity 系统管理器中，选择菜单：设置 [ 系统 ] 。
.. 在 * 驱动器安全密钥管理 * 下，选择 * 备份密钥 * 。
.. 在 * 定义密码短语 / 重新输入密码短语 * 字段中，输入并确认此备份副本的密码短语。
.. 单击 * 备份 * 。
.. 将您的关键信息记录在安全位置，然后单击 * 关闭 * 。


. 使用 SANtricity 系统管理器备份存储阵列的配置数据库。
+
如果删除控制器时出现问题，您可以使用保存的文件还原配置。系统将保存 RAID 配置数据库的当前状态，其中包括控制器上卷组和磁盘池的所有数据。

+
** 在 System Manager 中：
+
... 选择菜单： Support[ 支持中心 > 诊断 ] 。
... 选择 * 收集配置数据 * 。
... 单击 * 收集 * 。
+
此文件将保存在浏览器的 "Downloads" 文件夹中，名为 * configurationData-<arrayName>-<DateTime>.7z* 。



** 或者，您也可以使用以下命令行界面命令备份配置数据库：
+
`s存取存储阵列 dbmDatabase sourceLocation=Onboard contentType=all file="filename" ；`



. 使用 SANtricity 系统管理器收集存储阵列的支持数据。
+
如果删除控制器时出现问题，您可以使用保存的文件对问题描述进行故障排除。系统会将有关存储阵列的清单，状态和性能数据保存在一个文件中。

+
.. 选择菜单： Support[ 支持中心 > 诊断 ] 。
.. 选择 * 收集支持数据 * 。
.. 单击 * 收集 * 。
+
此文件将保存在浏览器的 "Downloads" 文件夹中，名为 * support-data.7z* 。



. 确保存储阵列与所有已连接主机之间未发生任何 I/O 操作。例如，您可以执行以下步骤：
+
** 停止涉及从存储映射到主机的 LUN 的所有进程。
** 确保没有应用程序向从存储映射到主机的任何 LUN 写入数据。
** 卸载与阵列上的卷关联的所有文件系统。
+

NOTE: 停止主机 I/O 操作的确切步骤取决于主机操作系统和配置，这些步骤不在本说明的范围之内。如果您不确定如何停止环境中的主机 I/O 操作，请考虑关闭主机。

+

CAUTION: * 可能的数据丢失 * - 如果在执行 I/O 操作时继续执行此操作步骤，则可能会丢失数据。



. 等待缓存中的所有数据写入驱动器。
+
需要将缓存数据写入驱动器时，控制器背面的绿色缓存活动 LED 亮起。您必须等待此 LED 关闭。

. 从 SANtricity 系统管理器的主页中，选择 * 查看正在执行的操作 * 。
. 确认所有操作均已完成，然后再继续下一步。
. 关闭控制器架上的两个电源开关。
. 等待控制器架上的所有 LED 熄灭。
. 从 Recovery Guru 中选择 * 重新检查 * ，然后确认详细信息区域中的 * 确定删除 * 字段显示 * 是 * ，表示可以安全删除此组件。
+
除非更换控制器箱，否则无法访问存储阵列上的数据。





== 第 2 步：删除故障控制器（单工）

将故障箱更换为新箱。



=== 步骤 2a ：卸下控制器箱（单工）

拆下控制器箱。

.步骤
. 戴上 ESD 腕带或采取其他防静电预防措施。
. 为连接到控制器箱的每个缆线贴上标签。
. 断开控制器箱的所有缆线。
+

CAUTION: To prevent degraded performance, do not twist, fold, pinch, or step on the cables.

. 如果控制器箱上的 HIC 端口使用 SFP+ 收发器，请卸下 SFP 。
+
由于必须从故障控制器箱中卸下 HIC ，因此必须从 HIC 端口中卸下所有 SFP 。但是，您可以保留在基板主机端口中安装的任何 SFP 。准备好为新控制器布线时，只需将这些 SFP 移至新控制器箱即可。如果您有多种类型的 SFP ，此方法尤其有用。

. 确认控制器背面的缓存活动 LED 是否熄灭。
+
需要将缓存数据写入驱动器时，控制器背面的绿色缓存活动 LED 亮起。您必须等待此 LED 熄灭，然后才能卸下控制器箱。

+

NOTE: 此图显示了一个控制器箱示例。您的控制器可能具有不同数量和类型的主机端口。

+
image::../media/28_dwg_2800_controller_attn_led_maint-e2800.gif[28 个 dwg 2800 控制器已连接到主维护 2800]

+
* （ 1 ） * _Cache 活动 LED

. 按压凸轮把手上的闩锁，直到其释放为止，然后打开右侧的凸轮把手，以从中板释放控制器箱。
+
image::../media/28_dwg_e2824_remove_controller_canister_simplex_maint-e2800.gif[28 dwg e2824 删除控制器箱单工维护 e2800]

+
* （ 1 ） * _ 控制器箱 _

+
* （ 2 ） * _Cam handle

. 用两只手和凸轮把手将控制器箱滑出磁盘架。
+

CAUTION: 始终用双手支撑控制器箱的重量。

+
卸下控制器箱时，一个翼片会摆动到位，以阻止空托架，从而有助于保持气流和散热。

. 将控制器箱翻转，使可拆卸盖朝上。
. 将控制器箱放在无静电的平面上。




=== 步骤 2b ：取出电池（单工）

从控制器架中取出控制器箱后，请取出电池。

.步骤
. 向下按按钮并滑动控制器箱盖，以卸下控制器箱盖。
. 确认控制器（电池和 DIMM 之间）中的绿色 LED 熄灭。
+
如果此绿色 LED 亮起，则表示控制器仍在使用电池电源。您必须等待此 LED 熄灭，然后才能卸下任何组件。

+
image::../media/28_dwg_e2800_internal_cache_active_led_maint-e2800.gif[28 dwg e2800 内部缓存活动 LED 维护 e2800]

+
* （ 1 ） * _Internal Cache Active_

+
* （ 2 ） * 电池 _

. 找到电池的蓝色释放闩锁。
. 向下推动释放闩锁并将其从控制器箱中移出，以解锁电池。
+
image::../media/28_dwg_e2800_remove_battery_maint-e2800.gif[28 dwg e2800 取出电池维护 e2800]

+
* （ 1 ） * 电池释放闩锁 _

+
* （ 2 ） * 电池 _

. 抬起电池，将其滑出控制器箱。




=== 步骤 2c ：卸下主机接口卡（单工）

如果控制器箱包含主机接口卡（ HIC ），请从原始控制器箱中取出 HIC ，以便可以在新控制器箱中重复使用。

.步骤
. 使用 1 号十字螺丝刀卸下将 HIC 面板连接到控制器箱的螺钉。
+
有四个螺钉：一个在顶部，一个在侧面，两个在正面。

+
image::../media/28_dwg_e2800_hic_faceplace_screws_maint-e2800.gif[28 个 dwg e2800 hic faceplace 螺钉 maint e2800]

. 卸下 HIC 面板。
. 使用您的手指或十字螺丝刀松开将 HIC 固定到控制器卡的三个翼形螺钉。
. 小心地将 HIC 从控制器卡上卸下，方法是将该卡抬起并滑回。
+

CAUTION: 请注意，不要擦除或撞击 HIC 底部或控制器卡顶部的组件。

+
image::../media/28_dwg_e2800_hic_thumbscrews_maint-e2800.gif[28 个 dwg e2800 hic 翼形螺钉 maint e2800]

+
* （ 1 ） * _ 主机接口卡 _

+
* （ 2 ） * _ 翼形螺钉 _

. 将 HIC 放置在无静电表面上。




== 第 3 步：安装新控制器（单工）

安装新的控制器箱以更换出现故障的控制器箱。



=== 第 3a 步：安装电池（单工）

将电池安装到更换用的控制器箱中。您可以安装从原始控制器箱中取出的电池，也可以安装您订购的新电池。

.步骤
. 拆开备用控制器箱的包装，将其放在无静电的平面上，使可拆卸盖朝上。
+
请保存包装材料，以便在运输故障控制器箱时使用。

. 向下按压盖板按钮，然后将盖板滑出。
. 调整控制器箱的方向，使电池插槽面向您。
. 将电池略微向下插入控制器箱。
+
您必须将电池前部的金属法兰插入控制器箱底部的插槽中，然后将电池顶部滑入控制器箱左侧的小对齐销下。

. 向上移动电池闩锁以固定电池。
+
当闩锁卡入到位时，闩锁的底部会挂到机箱上的金属插槽中。

+
image::../media/28_dwg_e2800_insert_battery_maint-e2800.gif[28 dwg e2800 插入电池维护 e2800]

+
* （ 1 ） * 电池释放闩锁 _

+
* （ 2 ） * 电池 _

. 将控制器箱翻转，以确认电池安装正确。
+

CAUTION: * 可能的硬件损坏 * —电池前部的金属法兰必须完全插入控制器箱上的插槽（如第一图所示）。如果电池安装不正确（如图 2 所示），则金属法兰可能会接触控制器板，从而在您接通电源时损坏控制器。

+
** * 正确 * —电池的金属法兰已完全插入控制器上的插槽：
+
image:../media/28_dwg_e2800_battery_flange_ok_maint-e2800.gif[""]

** * 不正确 * —电池的金属法兰未插入控制器上的插槽：
+
image:../media/28_dwg_e2800_battery_flange_not_ok_maint-e2800.gif[""]







=== 步骤 3b ：安装主机接口卡（单工）

如果您从原始控制器箱中卸下了主机接口卡（ HIC ），请将该 HIC 安装到新控制器箱中。

.步骤
. 使用 1 号十字螺丝刀，卸下将空白面板连接到更换用控制器箱的四个螺钉，然后卸下面板。
. 将 HIC 上的三个翼形螺钉与控制器上的相应孔对齐，并将 HIC 底部的连接器与控制器卡上的 HIC 接口连接器对齐。
+
请注意，不要擦除或撞击 HIC 底部或控制器卡顶部的组件。

. 小心地将 HIC 放低到位，然后轻按 HIC 以固定 HIC 连接器。
+

CAUTION: * 可能的设备损坏 * —请务必小心，不要挤压 HIC 和翼形螺钉之间控制器 LED 的金带连接器。

+
image::../media/28_dwg_e2800_hic_thumbscrews_maint-e2800.gif[28 个 dwg e2800 hic 翼形螺钉 maint e2800]

+
* （ 1 ） * _ 主机接口卡 _

+
* （ 2 ） * _ 翼形螺钉 _

. 手动拧紧 HIC 翼形螺钉。
+
请勿使用螺丝刀，否则可能会过度拧紧螺钉。

. 使用 1 号十字螺丝刀，使用四个螺钉将从原始控制器箱中卸下的 HIC 面板连接到新控制器箱。
+
image::../media/28_dwg_e2800_hic_faceplace_screws_maint-e2800.gif[28 个 dwg e2800 hic faceplace 螺钉 maint e2800]





=== 第 3c 步：安装新的控制器箱（单工）

安装电池和 HIC 后，如果最初安装了一个，则可以将新的控制器箱安装到控制器架中。

.步骤
. 将控制器箱盖从背面向前滑动，直到按钮卡入到位，从而重新安装控制器箱上的盖。
. 将控制器箱翻转，使可拆卸盖朝下。
. 在凸轮把手处于打开位置的情况下，将控制器箱完全滑入控制器架。
+
image::../media/28_dwg_e2824_remove_controller_canister_simplex_maint-e2800.gif[28 dwg e2824 删除控制器箱单工维护 e2800]

+
* （ 1 ） * _ 控制器箱 _

+
* （ 2 ） * _Cam handle

. 将凸轮把手移至左侧，将控制器箱锁定到位。
. 在新控制器的主机端口中安装原始控制器中的 SFP ，然后重新连接所有缆线。
+
如果使用多个主机协议，请确保将 SFP 安装在正确的主机端口中。

. 根据您是否将以太网端口 1 （标记为 P1 ）连接到具有 DHCP 服务器的网络以及所有驱动器是否都安全，确定如何为替代控制器分配 IP 地址。
+
|===
| 是否正在使用 DHCP 服务器？ | 是否保护所有驱动器？ | 步骤 


 a| 
是的。
 a| 
否
 a| 
新控制器从 DHCP 服务器获取其 IP 地址。此值可能与原始控制器的 IP 地址不同。在替代控制器背面的标签上找到 MAC 地址，并与您的网络管理员联系以获取 DHCP 服务器分配的 IP 地址。



 a| 
是的。
 a| 
是的。
 a| 
新控制器从 DHCP 服务器获取其 IP 地址。此值可能与原始控制器的 IP 地址不同。在替代控制器背面的标签上找到 MAC 地址，并与您的网络管理员联系以获取 DHCP 服务器分配的 IP 地址。然后，您可以使用命令行界面解锁驱动器。



 a| 
否
 a| 
否
 a| 
新控制器将采用您删除的控制器的 IP 地址。



 a| 
否
 a| 
是的。
 a| 
您必须手动设置新控制器的 IP 地址。（您可以重复使用旧控制器的 IP 地址或使用新的 IP 地址。） 如果控制器具有 IP 地址，您可以使用命令行界面解锁驱动器。驱动器解锁后，新控制器将自动重新使用原始控制器的 IP 地址。

|===




== 第 4 步：全面更换控制器（单工）

打开控制器架电源，收集支持数据并恢复操作。

.步骤
. 打开控制器架背面的两个电源开关。
+
** 请勿在启动过程中关闭电源开关，此过程通常需要 90 秒或更短的时间才能完成。
** 每个磁盘架中的风扇在首次启动时声音非常大。启动期间发出较大的噪音是正常的。


. 在控制器启动时，检查控制器 LED 和七段显示。
+
** 七段显示将重复显示 * 操作系统 * ， * 可持续发展 * ， * 空白 _* 序列，以指示控制器正在执行每日开始（ SOD ）处理。成功启动控制器后，其七段显示屏应显示托盘 ID 。
** 控制器上的琥珀色警示 LED 会亮起，然后熄灭，除非出现错误。
** 绿色主机链路 LED 亮起。
+

NOTE: 此图显示了一个控制器箱示例。您的控制器可能具有不同数量和类型的主机端口。

+
image::../media/28_dwg_attn_led_7s_display_maint-e2800.gif[28 dwg Attn led 7s 显示 maint e2800]

+
* （ 1 ） * _ 警示 LED （琥珀色） _

+
* （ 2 ） * _seven-segment display_

+
* （ 3 ） * _Host Link LED_



. 如果控制器架的任何警示 LED 仍保持亮起状态，请检查控制器箱是否已正确安装且所有缆线均已正确就位。如有必要，重新安装控制器箱。
+

NOTE: 如果无法解决此问题，请联系技术支持。

. 如果存储阵列具有安全驱动器，请导入驱动器安全密钥；否则，请转至下一步。对于包含所有安全驱动器的存储阵列，或者混合使用安全驱动器和非安全驱动器的存储阵列，请遵循以下相应的操作步骤。
+

NOTE: _Unsecure drives_ 是指未分配的驱动器，全局热备用驱动器，或者属于卷组或池的驱动器，这些驱动器不受驱动器安全功能的保护。_Secure drives_ 是使用 Drive Security 为属于安全卷组或磁盘池的驱动器分配的。

+
** * 仅限安全驱动器（无非安全驱动器） * ：
+
... 访问存储阵列的命令行界面（ CLI ）。
... 输入以下命令以导入安全密钥：
+
[listing]
----
import storageArray securityKey file="C:/file.slk"
passPhrase="passPhrase";
----
+
其中：

+
**** `C ： /file.slk` 表示驱动器安全密钥的目录位置和名称
**** `passphrase` 是在导入安全密钥，控制器重新启动且新控制器采用存储阵列的已保存设置后解锁文件所需的密码短语。


... 转至下一步以确认新控制器是否处于最佳状态。


** * 混合使用安全驱动器和非安全驱动器 * ：
+
... 收集支持包并打开存储阵列配置文件。
... 找到并记录所有不安全驱动器的位置，这些位置可在支持包中找到。
... 关闭系统电源。
... 删除不安全的驱动器。
... 更换控制器。
... 打开系统电源，等待七段显示器显示托盘编号。
... 在 SANtricity 系统管理器中，选择菜单：设置 [ 系统 ] 。
... 在安全密钥管理部分中，选择 * 创建 / 更改密钥 * 以创建新的安全密钥。
... 选择 * 解锁安全驱动器 * 以导入您保存的安全密钥。
... 运行 `set allDrives nativeState` CLI 命令。
+
控制器将自动重新启动。

... 等待控制器启动，并等待七段显示器显示托盘编号或闪烁的 L5 。
... 关闭系统电源。
... 重新安装不安全的驱动器。
... 使用 SANtricity 系统管理器重置控制器。
... 打开系统电源，等待七段显示器显示托盘编号。
... 转至下一步以确认新控制器是否处于最佳状态。




. 在 SANtricity 系统管理器中，确认新控制器处于最佳状态。
+
.. 选择 * 硬件 * 。
.. 对于控制器架，选择 * 显示磁盘架的背面 * 。
.. 选择您更换的控制器箱。
.. 选择 * 查看设置 * 。
.. 确认控制器的 * 状态 * 为最佳状态。
.. 如果状态不是最佳状态，请突出显示控制器，然后选择 * 置于联机状态 * 。


. 当控制器恢复联机时、检查Recovery Guru中是否报告NV挽 不匹配。
+
.. 如果报告NVSametmismatch、请使用以下SMcli命令升级NVSametm:
+
[listing]
----
SMcli <controller A IP> <controller B IP> -u admin -p <password> -k -c "download storageArray NVSRAM file=\"C:\Users\testuser\Downloads\NVSRAM .dlp file>\" forceDownload=TRUE;"
----
+
。 `-k` 如果阵列不是https安全、则需要参数。



+

NOTE: 如果无法完成SMcli命令、请联系 https://www.netapp.com/company/contact-us/support/["NetApp技术支持"^] 或登录到 https://mysupport.netapp.com["NetApp 支持站点"^] 创建案例。

. 使用 SANtricity 系统管理器收集存储阵列的支持数据。
+
.. 选择菜单： Support[ 支持中心 > * 诊断 ] 。
.. 选择 * 收集支持数据 * 。
.. 单击 * 收集 * 。
+
此文件将保存在浏览器的 "Downloads" 文件夹中，名为 * support-data.7z* 。





.下一步是什么？
控制器更换已完成。您可以恢复正常操作。
