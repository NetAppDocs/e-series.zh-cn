---
permalink: maintenance-e2800/hpp-overview-supertask-concept.html 
sidebar: sidebar 
keywords: E2800 convert host port protocol, convert E2800 FC iSCSI, Fibre Channel protocol, iSCSI protocol, convert HPP, converting host port protocol, SFP+ (optical) host ports, E2800, E-Series, eseries 
summary: 查看 E2800 上的主机端口协议转换要求。 
---
= 更改 E2800 主机端口协议的要求
:icons: font
:imagesdir: ../media/


[role="lead"]
在转换 E2800 阵列的主机协议之前，请查看相关要求。



== 可以更改的主机端口

下图显示了一个 E2800 控制器的背面，该控制器具有两个 SFP+ （光纤）基板主机端口 * （ 1 ） * 和四个 SFP+ （光纤） HIC 端口 * （ 2 ） * 。

image::../media/28_dwg_e2800_optical_base_quad_sfp_hic.gif[28 dwg e2800 光纤基座四个 SFP hic]


NOTE: 此外，还提供双端口 HIC 。

存储阵列中的 E2800 控制器可能具有不同类型的基板主机端口和不同类型的 HIC 端口。下表显示了可使用功能包更改的主机端口。

|===
| 如果您有这些基板主机端口 ... | 您有这些 HIC 端口 ... | 您可以更改 ... 


 a| 
两个 SFP+ （光纤）端口
 a| 
无
 a| 
仅限基板主机端口



 a| 
两个 SFP+ （光纤）端口
 a| 
四个 SFP+ （光纤）端口
 a| 
所有端口



 a| 
两个 SFP+ （光纤）端口
 a| 
两个 SFP+ （光纤）端口
 a| 
所有端口



 a| 
两个 SFP+ （光纤）端口
 a| 
两个或四个 SAS 端口
 a| 
仅限基板主机端口



 a| 
两个 SFP+ （光纤）端口
 a| 
两个 RJ-45 （ BASE-T ）端口
 a| 
仅限基板主机端口



 a| 
两个 RJ-45 （ BASE-T ）端口
 a| 
无
 a| 
无端口



 a| 
两个 RJ-45 （ BASE-T ）端口
 a| 
两个 RJ-45 （ BASE-T ）端口
 a| 
无端口

|===
基板主机端口和 HIC 端口可以使用相同的主机协议或不同的主机协议。



== 更改主机协议的要求

* 您必须为此操作步骤计划停机维护窗口。
* 在执行转换时，您必须停止主机 I/O 操作，并且在成功完成转换之前，您将无法访问存储阵列上的数据。
* 您必须使用带外管理。（您不能使用带内管理来完成此操作步骤。）
* 您已获得转换所需的硬件。您的 NetApp 销售代表可以帮助您确定所需的硬件，并帮助您订购正确的部件。
* 如果您尝试更改存储阵列的基板主机端口，并且该阵列当前使用从 NetApp 购买的双协议（也称为 _unified_） SFP 收发器，则无需更改 SFP 收发器。
* 确保双协议 SFP 收发器既支持 FC （ 4 Gbps ， 16 Gbps ）又支持 iSCSI （ 10 Gbps ），但不支持 1 Gbps iSCSI 。请参见 link:../maintenance-e2800/hpp-change-host-protocol-task.html["第 1 步：确定您是否具有双协议 SFP"] 以确定安装的 SFP 收发器类型。




== 更改主机协议的注意事项

更改主机协议的注意事项取决于基板主机端口和 HIC 端口的起始和结束协议。

如果您使用镜像功能或数据保证（ Data Assurance ， DA ）功能，则必须了解在按如下所述更改主机端口协议时这些功能会发生什么情况。


NOTE: 只有在转换已使用的存储阵列时，以下注意事项才适用。如果要转换尚未定义主机和卷的新存储阵列，则这些注意事项不适用。



=== 从 FC 转换为 iSCSI

* 如果您的配置包含连接到 FC 基板端口的 SAN 启动主机，请检查 https://mysupport.netapp.com/NOW/products/interoperability["NetApp 互操作性表"^] 用于确保 iSCSI 支持此配置的工具。否则，您将无法将主机协议转换为 iSCSI 。
* iSCSI 不支持 DA 功能。
+
** 如果您当前正在使用 DA ，并且要将 FC 主机端口转换为 iSCSI ，则必须在所有卷上禁用 DA 。
** 如果在转换为 iSCSI 之前未停用 DA ，则在转换后存储阵列将不合规。


* iSCSI 不支持同步镜像功能。
+
** 如果您当前正在使用同步镜像关系，并且要将 FC 主机端口转换为 iSCSI ，则必须停用同步镜像。
** 要删除所有同步镜像对，请参见 SANtricity 系统管理器的联机帮助，此操作将删除本地存储阵列和远程存储阵列上的镜像关系。此外，请按照联机帮助中的说明停用同步镜像。
+

CAUTION: 如果在转换为 iSCSI 之前未停用同步镜像关系，则系统将丢失数据访问，并且可能发生数据丢失。



* 异步镜像要求本地存储阵列和远程存储阵列使用相同的协议。
+
** 如果您当前正在使用异步镜像，并且要将所有主机端口从 FC 转换为 iSCSI ，则必须在应用功能包之前停用异步镜像。
** 要从本地和远程存储阵列中删除所有镜像一致性组并删除所有镜像对，请参见 SANtricity 系统管理器的联机帮助。此外，请按照联机帮助中的说明停用异步镜像。






=== 从 iSCSI 转换为 FC

* 异步镜像要求本地存储阵列和远程存储阵列使用相同的协议。如果您当前正在对基板端口使用异步镜像，则必须在更改协议之前停用异步镜像。
* 要从本地和远程存储阵列中删除所有镜像一致性组并删除所有镜像对，请参见 SANtricity 系统管理器的联机帮助。此外，请按照联机帮助中的说明停用异步镜像。




=== 从 FC 转换为 FC/iSCSI

镜像注意事项：

* iSCSI 不支持同步镜像。
* 如果用于镜像的存储阵列当前只有 FC 端口，而您希望将其中一些端口转换为 iSCSI ，则必须确定用于镜像的端口。
* 只要在转换后两个存储阵列都至少有一个活动 FC 端口，您就无需将本地存储阵列和远程存储阵列上的端口转换为相同的协议。
* 如果您计划转换用于镜像关系的端口，则必须在应用功能包之前停用任何同步或异步镜像关系。
* 如果您计划转换用于镜像的 _not_ 端口，异步镜像操作将不受影响。
* 在应用此功能包之前，您应确认所有镜像一致性组均已同步。应用此功能包后，您应测试本地存储阵列与远程存储阵列之间的通信。


数据保证注意事项：

* iSCSI 不支持数据保证（ Data Assurance ， DA ）功能。
+
要确保数据访问保持无中断，您可能需要在应用功能包之前从主机集群重新映射或删除 DA 卷。

+
|===
| 如果您有 ... | 您必须 ... 


 a| 
默认集群中的 DA 卷
 a| 
重新映射默认集群中的所有 DA 卷。

** 如果您不想在主机之间共享 DA 卷，请按照以下步骤操作：
+
... 为每组 FC 主机端口创建一个主机分区（除非已经这样做）。
... 将 DA 卷重新映射到相应的主机端口。


** 如果要在主机之间共享 DA 卷，请执行以下步骤：
+
... 为每组 FC 主机端口创建一个主机分区（除非已经这样做）。
... 创建包含相应主机端口的主机集群。
... 将 DA 卷重新映射到新的主机集群。
+

NOTE: 此方法可消除对保留在默认集群中的任何卷的卷访问。







 a| 
主机集群中包含仅 FC 主机的 DA 卷，并且您希望添加仅 iSCSI 主机
 a| 
使用以下选项之一删除属于集群的任何 DA 卷。


NOTE: 在这种情况下，无法共享 DA 卷。

** 如果不希望在主机之间共享 DA 卷，请将所有 DA 卷重新映射到集群中的各个 FC 主机。
** 将仅使用 iSCSI 的主机隔离到其自己的主机集群中，并保持 FC 主机集群不变（使用共享 DA 卷）。
** 将 FC HBA 添加到仅支持 iSCSI 的主机，以便可以共享 DA 卷和非 DA 卷。




 a| 
包含纯 FC 主机的主机集群中的 DA 卷或映射到单个 FC 主机分区的 DA 卷
 a| 
在应用此功能包之前，无需执行任何操作。DA 卷仍会映射到其各自的 FC 主机。



 a| 
未定义分区
 a| 
应用功能包之前无需执行任何操作，因为当前未映射任何卷。转换主机协议后，按照相应的操作步骤创建主机分区，如果需要，还可以创建主机集群。

|===




=== 从 iSCSI 转换为 FC/iSCSI

* 如果您计划转换用于镜像的端口，则必须将镜像关系移动到转换后仍保留 iSCSI 的端口。
+
否则，由于本地阵列上的新 FC 端口与远程阵列上的现有 iSCSI 端口之间的协议不匹配，转换后通信链路可能会关闭。

* 如果您计划转换不用于镜像的端口，异步镜像操作将不受影响。
+
在应用此功能包之前，您应确认所有镜像一致性组均已同步。应用此功能包后，您应测试本地存储阵列与远程存储阵列之间的通信。





=== 从 FC/iSCSI 转换为 FC

* 将所有主机端口转换为 FC 时，请注意，必须在编号最高的 FC 端口上通过 FC 进行异步镜像。
* 如果您计划转换用于镜像关系的端口，则必须先停用这些关系，然后再应用功能包。
+

CAUTION: * 可能的数据丢失 * - 如果在将端口转换为 FC 之前未删除通过 iSCSI 建立的异步镜像关系，则控制器可能会锁定，并且您可能会丢失数据。

* 如果存储阵列当前具有 iSCSI 基板端口和 FC HIC 端口，则异步镜像操作不会受到影响。
+
在转换前后，镜像将发生在编号最高的 FC 端口上，该端口将保留图中标记为 * 2 * 的 HIC 端口。在应用此功能包之前，您应确认所有镜像一致性组均已同步。应用此功能包后，您应测试本地存储阵列与远程存储阵列之间的通信。

* 如果存储阵列当前具有 FC 基板端口和 iSCSI HIC 端口，则在应用功能包之前，必须删除通过 FC 发生的任何镜像关系。
+
应用功能包时，镜像支持将从编号最高的基板主机端口（图中标记为 * 1 * ）移至编号最高的 HIC 端口（图中标记为 * 2 * ）。

+
image::../media/28_dwg_e2800_fc_iscsi_to_fc.gif[28 dwg e2800 fc iscsi 到 fc]

+
|===
3+| 转换前 3+| 转换后 .2+| 所需步骤 


| 基板端口 | HIC 端口 | 用于镜像的端口 | 基板端口 | HIC 端口 | 用于镜像的端口 


 a| 
iSCSI
 a| 
FC
 a| 
* （ 2 ） *
 a| 
FC
 a| 
FC
 a| 
* （ 2 ） *
 a| 
同步镜像一致性组之前，然后测试通信之后



 a| 
FC
 a| 
iSCSI
 a| 
* （ 1 ） *
 a| 
FC
 a| 
FC
 a| 
* （ 2 ） *
 a| 
删除之前的镜像关系，然后在之后重新建立镜像

|===




=== 从 FC/iSCSI 转换为 iSCSI

* iSCSI 不支持同步镜像。
* 如果您计划转换用于镜像关系的端口，则必须在应用功能包之前停用镜像关系。
+

CAUTION: * 可能的数据丢失 * - 如果在将端口转换为 iSCSI 之前未删除通过 FC 建立的镜像关系，则控制器可能会锁定，并且您可能会丢失数据。

* 如果您不打算转换用于镜像的端口，则镜像操作不会受到影响。
* 在应用此功能包之前，您应确认所有镜像一致性组均已同步。
* 应用此功能包后，您应测试本地存储阵列与远程存储阵列之间的通信。




=== 相同的主机协议和镜像操作

如果在应用功能包后用于镜像的主机端口保持相同的协议，则镜像操作不会受到影响。即使如此，在应用此功能包之前，您应确认所有镜像一致性组均已同步。

应用此功能包后，您应测试本地存储阵列与远程存储阵列之间的通信。如果您对此有任何疑问，请参见 SANtricity System Manager 的联机帮助。
